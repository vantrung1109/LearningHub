<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dev Knowledge Hub â€” 1 file</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <style>
    .line-clamp-6 {
      display: -webkit-box;
      -webkit-line-clamp: 6;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    dialog[open]::backdrop { background: rgba(0,0,0,.25); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-white text-slate-900">
  <div class="h-screen flex">

    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 border-r bg-white/60 backdrop-blur supports-[backdrop-filter]:bg-white/40 transition-all">
      <div class="flex items-center justify-between p-3">
        <div class="text-lg font-semibold">Knowledge</div>
        <button id="toggleSidebar" class="p-2 rounded hover:bg-slate-100" title="Thu gá»n">â´</button>
      </div>

      <div class="px-2">
        <button data-filter="all" class="w-full flex items-center justify-between px-3 py-2 rounded hover:bg-slate-100 filter-btn">
          <span class="flex items-center gap-2">ğŸ“š All</span>
          <span id="count-all" class="text-xs px-2 py-0.5 bg-slate-200 rounded">0</span>
        </button>
      </div>

      <div class="mt-2 space-y-1 px-2">
        <button data-filter="android" class="w-full flex items-center justify-between px-3 py-2 rounded hover:bg-slate-100 filter-btn">
          <span class="flex items-center gap-2">ğŸ¤– Android</span>
          <span id="count-android" class="text-xs px-2 py-0.5 bg-slate-200 rounded">0</span>
        </button>
        <button data-filter="kotlin" class="w-full flex items-center justify-between px-3 py-2 rounded hover:bg-slate-100 filter-btn">
          <span class="flex items-center gap-2">ğŸ§© Kotlin</span>
          <span id="count-kotlin" class="text-xs px-2 py-0.5 bg-slate-200 rounded">0</span>
        </button>
        <button data-filter="compose" class="w-full flex items-center justify-between px-3 py-2 rounded hover:bg-slate-100 filter-btn">
          <span class="flex items-center gap-2">ğŸ“˜ Jetpack Compose</span>
          <span id="count-compose" class="text-xs px-2 py-0.5 bg-slate-200 rounded">0</span>
        </button>
      </div>

      <div class="mt-6 px-3 text-xs text-slate-500">
        Tip: dá»¯ liá»‡u lÆ°u trong trÃ¬nh duyá»‡t (localStorage).
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 flex flex-col overflow-hidden">
      <header class="flex items-center justify-between border-b bg-white/70 px-4 py-3 backdrop-blur supports-[backdrop-filter]:bg-white/40">
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2">ğŸ”</span>
          <input id="search" class="pl-9 w-72 border rounded px-3 py-2" placeholder="Search title, content, tagsâ€¦" />
        </div>
        <div class="flex items-center gap-2">
          <input id="importInput" type="file" accept=".md,.markdown,.txt" class="hidden" />
          <button id="importBtn" class="px-3 py-2 border rounded hover:bg-slate-100">â¬†ï¸ Import .md</button>
          <button id="newBtn" class="px-3 py-2 bg-slate-900 text-white rounded hover:opacity-90">â• New note</button>
        </div>
      </header>

      <section class="flex-1 p-4 overflow-auto">
        <div id="empty" class="hidden h-64 text-slate-500 flex items-center justify-center">
          ChÆ°a cÃ³ ghi chÃº. Báº¥m â€œNew noteâ€ Ä‘á»ƒ thÃªm.
        </div>
        <div id="grid" class="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3"></div>
      </section>
    </main>
  </div>

  <!-- Editor dialog -->
  <dialog id="editor" class="rounded-xl w-[min(720px,92vw)] border p-0">
    <form method="dialog">
      <div class="p-4 border-b">
        <h3 id="editorTitle" class="text-lg font-semibold">Add a new note</h3>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <label class="text-sm font-medium">Title</label>
          <input id="f-title" class="w-full mt-1 border rounded px-3 py-2" />
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium">Section</label>
            <select id="f-section" class="w-full mt-1 border rounded px-3 py-2">
              <option value="android">Android</option>
              <option value="kotlin">Kotlin</option>
              <option value="compose">Jetpack Compose</option>
            </select>
          </div>
          <div>
            <label class="text-sm font-medium">Tags (comma separated)</label>
            <input id="f-tags" class="w-full mt-1 border rounded px-3 py-2" />
          </div>
        </div>

        <div class="flex items-center justify-between">
          <span class="text-sm font-medium">Markdown</span>
          <div class="flex items-center gap-2">
            <input id="editorUpload" type="file" accept=".md,.markdown,.txt" class="hidden" />
            <button id="editorUploadBtn" type="button" class="px-3 py-2 border rounded hover:bg-slate-100">â¬†ï¸ Upload .md</button>
          </div>
        </div>

        <div class="border rounded overflow-hidden">
          <div class="flex border-b">
            <button id="tabWrite" type="button" class="px-4 py-2 text-sm border-r bg-slate-100">Write</button>
            <button id="tabPreview" type="button" class="px-4 py-2 text-sm">Preview</button>
          </div>
          <textarea id="f-content" rows="12" class="w-full p-3 outline-none" placeholder="# Title\n\nWrite your note in **Markdown** here..."></textarea>
          <div id="preview" class="hidden p-4 prose max-w-none"></div>
        </div>
      </div>
      <div class="p-4 border-t flex items-center justify-end gap-2">
        <button id="cancelBtn" class="px-3 py-2 border rounded">Cancel</button>
        <button id="saveBtn" class="px-3 py-2 bg-slate-900 text-white rounded">ğŸ’¾ Save</button>
      </div>
    </form>
  </dialog>

  <!-- Viewer dialog -->
  <dialog id="viewer" class="rounded-xl w-[min(800px,92vw)] border p-0">
    <div class="p-4 border-b flex items-center justify-between">
      <h3 id="viewerTitle" class="text-lg font-semibold">Title</h3>
      <div class="flex items-center gap-2">
        <button id="viewerDownload" class="text-sm px-2 py-1 border rounded">â¬‡ï¸ .md</button>
        <button id="viewerClose" class="text-sm px-2 py-1 border rounded">âœ•</button>
      </div>
    </div>
    <div id="viewerBody" class="p-4 prose max-w-none overflow-auto h-[70vh]"></div>
  </dialog>

  <script>
    const STORAGE_KEY="dev-notes-v1";let notes=[],filter="all",query="",editingId=null;
    const grid=document.getElementById("grid"),empty=document.getElementById("empty");
    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}
    function now(){return Date.now()}function fmt(t){return new Date(t).toLocaleString()}
    function parseTitleFromMarkdown(md){const lines=md.split(/\r?\n/);for(const l of lines){const m=l.match(/^\s*#\s*(.+)$/);if(m)return m[1].trim()}return (lines.find(l=>l.trim().length)||"Untitled").slice(0,80)}
    function loadNotes(){try{const r=localStorage.getItem(STORAGE_KEY);if(r)return JSON.parse(r)}catch{}return []}
    function saveNotes(){localStorage.setItem(STORAGE_KEY,JSON.stringify(notes))}
    function downloadText(name,text){const b=new Blob([text],{type:"text/markdown"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u)}
    function renderCounts(){["all","android","kotlin","compose"].forEach(s=>{const c=s==="all"?notes.length:notes.filter(n=>n.section===s).length;document.getElementById("count-"+s).textContent=c})}
    function renderList(){const q=query.trim().toLowerCase();let list=notes.filter(n=>filter==="all"||n.section===filter).filter(n=>!q||n.title.toLowerCase().includes(q)||n.content.toLowerCase().includes(q)||n.tags.join(" ").toLowerCase().includes(q)).sort((a,b)=>b.updatedAt-a.updatedAt);
      grid.innerHTML="";if(list.length===0){empty.classList.remove("hidden");return}else empty.classList.add("hidden");
      list.forEach(n=>{const card=document.createElement("div");card.className="group border rounded-xl bg-white shadow-sm hover:shadow transition";
        card.innerHTML=`<div class='p-4 border-b flex justify-between'><div class='text-base font-semibold leading-tight'>${n.title}</div><button class='text-sm opacity-60 hover:opacity-100' title='menu'>â‹¯</button></div>
        <div class='p-4 text-sm line-clamp-6 whitespace-pre-wrap leading-relaxed'>${n.content}</div>
        <div class='px-4 py-2 border-t text-xs text-slate-500'>Updated ${fmt(n.updatedAt)}</div>`;
        card.addEventListener("click",e=>{if(e.target.closest("button"))return;openViewer(n)});
        grid.appendChild(card);
      });
    }

    // Viewer
    const viewer=document.getElementById("viewer"),viewerTitle=document.getElementById("viewerTitle"),viewerBody=document.getElementById("viewerBody");
    document.getElementById("viewerClose").addEventListener("click",()=>viewer.close());
    function openViewer(n){viewerTitle.textContent=n.title;const html=marked.parse(n.content||"");viewerBody.innerHTML=DOMPurify.sanitize(html);viewer.showModal();}
    document.getElementById("viewerDownload").addEventListener("click",()=>{const t=viewerTitle.textContent;const md=notes.find(n=>n.title===t);if(!md)return;const header=md.title.startsWith("#")?md.title:"# "+md.title;const meta=md.tags.length?`\n\n> Tags: ${md.tags.join(", ")}`:"";downloadText(`${md.title.replace(/[^a-z0-9-_ ]/gi,"_")}.md`,`${header}\n\n${md.content}${meta}\n`)})

    // Editor simplified (save)
    const dlg=document.getElementById("editor"),fTitle=document.getElementById("f-title"),fSection=document.getElementById("f-section"),fTags=document.getElementById("f-tags"),fContent=document.getElementById("f-content");
    document.getElementById("newBtn").addEventListener("click",()=>{editingId=null;fTitle.value="";fTags.value="";fContent.value="";dlg.showModal();});
    document.getElementById("saveBtn").addEventListener("click",e=>{e.preventDefault();const title=fTitle.value.trim()||parseTitleFromMarkdown(fContent.value);if(!title)return;const section=fSection.value,tags=fTags.value.split(",").map(t=>t.trim()).filter(Boolean),content=fContent.value;if(editingId){notes=notes.map(n=>n.id===editingId?{...n,title,section,tags,content,updatedAt:now()}:n)}else{notes=[{id:uid(),title,section,tags,content,updatedAt:now()},...notes]}saveNotes();renderCounts();renderList();dlg.close();});
    document.getElementById("cancelBtn").addEventListener("click",e=>{e.preventDefault();dlg.close();});
    document.getElementById("search").addEventListener("input",e=>{query=e.target.value;renderList();});
    document.querySelectorAll(".filter-btn").forEach(b=>b.addEventListener("click",()=>{filter=b.dataset.filter;renderCounts();renderList();}));
    notes=loadNotes();renderCounts();renderList();
  </script>
</body>
</html>
